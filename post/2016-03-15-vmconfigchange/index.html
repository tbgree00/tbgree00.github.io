<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Investigating VM Configuration Changes</title>
<meta name="description" content=" Based in Lexington, KY, Virtualizing a Physical World is a blog by Thom Greene. His posts explore the world of technology certification, VMware troubleshooting, and interesting experiences in the tech world.">
<meta name="generator" content="Hugo 0.37" />
<meta property="og:title" content="Investigating VM Configuration Changes" />
<meta property="og:description" content="Tracking resource configuration is a common struggle for an enterprise level environment. Even SMBs can have trouble keeping track of how their memory is provisioned and when it changes. What&rsquo;s worse, VMware&rsquo;s vSphere Client doesn&rsquo;t provide any insight as to what changes when someone edits the virtual machine settings. An event named&rdquo;Reconfigure virtual machine&rdquo; hits the task log but this isn&rsquo;t a lot of information. If you open Edit Settings and click OK vCenter registers this event even if you didn&rsquo;t change anything." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.thomgreene.com/post/2016-03-15-vmconfigchange/" />



<meta property="article:published_time" content="2016-03-15T12:57:51-04:00"/>

<meta property="article:modified_time" content="2016-03-15T12:57:51-04:00"/>











<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700" type="text/css" media="all" />
<link rel="stylesheet" href="/css/style.css" type="text/css" media="all" />
<script type="text/javascript" src="/js/scripts.js"></script>
<link rel="shortcut icon" href="/favicon.ico">

<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-117155450-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>
<body class="body body-right-sidebar mobile" itemscope="itemscope" itemtype="http://schema.org/WebPage">
	<div class="container container-outer">
		<header class="header" itemscope="itemscope" itemtype="http://schema.org/WPHeader">
			<div class="container container-inner clearfix">
				<div class="logo" role="banner" itemscope="itemscope" itemtype="http://schema.org/Brand">
					<a class="logo__link" href="/" title="Virtualizing a Physical World" rel="home">
						<h1 class="logo__title">Virtualizing a Physical World</h1>
						<h2 class="logo__tagline">Virtualizaton Blogging</h2>
					</a>
				</div>
			</div>
			
<nav class="menu" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement">
	<ul class="menu__list">
		<li class="menu__item"><a class="menu__link" href="/page/vrops/">VROPS</a></li>
		<li class="menu__item"><a class="menu__link" href="/tags/azure/">AZURE</a></li>
		<li class="menu__item"><a class="menu__link" href="/page/about/">ABOUT</a></li>
	</ul>
</nav>

		</header>
		<div class="wrapper clearfix">

<main class="main-content content" role="main" itemprop="mainContentOfPage">
	<article class="post">
		<header class="post__header clearfix">
			<h1 class="post__title">Investigating VM Configuration Changes</h1>
			<p class="post__meta meta">
				<svg class="icon icon-time" height="14" viewBox="0 0 16 16" width="14" xmlns="http://www.w3.org/2000/svg"><path d="m8-.0000003c-4.4 0-8 3.6-8 8 0 4.4000003 3.6 8.0000003 8 8.0000003 4.4 0 8-3.6 8-8.0000003 0-4.4-3.6-8-8-8zm0 14.4000003c-3.52 0-6.4-2.88-6.4-6.4000003 0-3.52 2.88-6.4 6.4-6.4 3.52 0 6.4 2.88 6.4 6.4 0 3.5200003-2.88 6.4000003-6.4 6.4000003zm.4-10.4000003h-1.2v4.8l4.16 2.5600003.64-1.04-3.6-2.1600003z"/></svg>
				<time class="post__meta-date" datetime="2016-03-15T12:57:51">March 15, 2016</time>
				<span class="post__meta-categories meta-categories">
					<svg class="icon icon-category" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
					<a class="meta-categories__link" href="/categories/vmware" rel="category">VMware</a>, <a class="meta-categories__link" href="/categories/troubleshooting" rel="category">Troubleshooting</a></span>
			</p>
		</header>
		<div class="post__content clearfix">
			

<p>Tracking resource configuration is a common struggle for an enterprise level environment. Even SMBs can have trouble keeping track of how their memory is provisioned and when it changes. What&rsquo;s worse, VMware&rsquo;s vSphere Client doesn&rsquo;t provide any insight as to what changes when someone edits the virtual machine settings. An event named&rdquo;Reconfigure virtual machine&rdquo; hits the task log but this isn&rsquo;t a lot of information. If you open Edit Settings and click OK vCenter registers this event even if you didn&rsquo;t change anything. This does, however give you a timestamp (and username) for our investigation.
Someone opened Edit Settings, but what did they edit?</p>

<p><img src="https://s3.us-east-2.amazonaws.com/thomgreene-blog-photos/vmware/vmconfigchanges/01-ReconfigEvent.png" alt="Someone opened Edit Settings, but what did they edit?" /></p>

<p>The Events log doesn&rsquo;t tell you much either. It may return &ldquo;Resource allocation changed&rdquo; but you will also see those events if you vMotion a virtual machine or DRS moves it. This still isn&rsquo;t a smoking gun to say &ldquo;The memory was changed to X GB at this time&rdquo;.</p>

<h2 id="vmware-log-to-the-rescue">VMware.log to the rescue</h2>

<p>Thankfully there is a way to get a timestamp that tells you exactly when a VM had its memory changed and how much it was set to&hellip; time to SSH into a host to find <strong>vmware.log</strong></p>

<p>VMware.log is a file located in the datastore that stores your machine&rsquo;s vmx file. It&rsquo;s a running log of everything happening to the machine. By default VMware keeps 10 rotations so you could see up to 10 files. If you want to change the location, maximum size, or rotations to keep check out <a href="https://kb.vmware.com/selfservice/search.do?cmd=displayKC&amp;docType=kc&amp;docTypeID=DT_KB_1_1&amp;externalId=8182749">KB 8182749</a>.</p>

<p>There are many paths we can take at this point. We could browse the datastore and download the vmware.log file or files with the timestamp we want to investigate. My personal preference is to turn to the command line to investigate. I&rsquo;ll run through each of the commands individually.</p>

<p>Open putty or your SSH client of choice and connect to the host. Remember to start the SSH service on the host if you haven&rsquo;t already!</p>

<p><img src="https://s3.us-east-2.amazonaws.com/thomgreene-blog-photos/vmware/vmconfigchanges/02-putty.png" alt="putty" /></p>

<p>Browse to the datastore. If you aren&rsquo;t familiar with navigating a non-Windows file system, use <strong>ls</strong> to list the contents of your current directory, the same as <strong>dir</strong> in Windows.</p>

<p><img src="https://s3.us-east-2.amazonaws.com/thomgreene-blog-photos/vmware/vmconfigchanges/03-browsehost.png" alt="Browse Host" /></p>

<p>We are trying to get to the datastore that your virtual machine is sitting on. to get there you can <strong>cd</strong> into directory like a windows command prompt.</p>

<pre><code>~# cd /vmfs/volumes/DATASTORE/VIRTUALMACHINE/
</code></pre>

<p>This would take you into the directory for the vm VIRTUALMACHINE in the DATASTORE datastore. ESXi&rsquo;s file system is case sensitive so you have to be careful when typing. It does support tab completion. If you start typing a command or directory name the TAB key will autocomplete the word for you. It&rsquo;s a handy trick.</p>

<p>Now we&rsquo;re in the offending virtual machine&rsquo;s directory. At this point, type <strong>ls -l</strong> to return the contents of the directory with a timestamp. Remember, you&rsquo;re looking for one of possibly ten vmware.log files.</p>

<p>Let&rsquo;s say you have decided vmware-3.log has a timestamp that would correspond with one of the earlier identified reconfigure log entries. use a <strong>grep</strong> to search the log file for the term <strong>memsize</strong>. If you want to see about a number of vCPU the term is <strong>numVCP</strong>. Lastly if you suspect someone of growing a hard drive the search term is <strong>&lsquo;Growing disk&rsquo;</strong></p>

<pre><code># grep memsize vmware-3.log
</code></pre>

<p><img src="https://s3.us-east-2.amazonaws.com/thomgreene-blog-photos/vmware/vmconfigchanges/04-grepoutput.png" alt="Grep Output" /></p>

<p>As you can see there&rsquo;s an entry that says ConfigDB: Setting memsize = &ldquo;4096&rdquo;. Whomever edited the virtual machine at this time was the culprit!</p>

<h2 id="summary">Summary</h2>

<p>To sum it all up:</p>

<ol>
<li>Check the virtual machine&rsquo;s Tasks log to get a timestamp for the change (search for reconfigure if you have a very busy task list!)</li>
<li>SSH into the host and navigate to the virtual machine&rsquo;s folder</li>
<li>Identify the vmware.log file that should have the resource change (ls -l to list the folder details)</li>
<li>run <strong>grep memsize vmware-X.log</strong> where X = the appropriate log file</li>
</ol>

<p>Reddit user /u/ajz (@ajz on twitter) wrote some commands to investigate these changes in <a href="https://www.reddit.com/r/vmware/comments/4akx3o/when_did_somebody_change_the_memory/d126zrc">PowerCLI</a></p>

<pre><code>Connect-VIServer &quot;vcenterserver&quot;
$vm = &quot;vmname&quot;
$changeevents = Get-VM $vm | Get-VIEvent | Where { $_.FullFormattedMessage -like &quot;Reconfigured*&quot;}
$changeevents[0].UserName
$changeevents[0].ConfigSpec
</code></pre>

<p>Thanks again to AJZ.</p>

<p>When I worked with the commands they worked perfectly but they give a lot of information and I needed to experiment to figure out exactly how they work. The [0] refers to the most recent event that matches the filter. One of my test VMs was edited multiple times so I wanted to return all the changes. Here is my modification:</p>

<pre><code>Connect-VIServer &quot;vcenterserver&quot;
$vm = &quot;vmname&quot;
$changeevents = Get-VM $vm | Get-VIEvent | Where { $_.FullFormattedMessage -like &quot;Reconfigured*&quot;}
$changeevents[0,1,2].UserName
$changeevents[0,1,2].ConfigSpec |Select-Object NumCPUs, MemoryMB, DeviceChange
</code></pre>

<p>This returns the usernames of the three most recent reconfiguration events on one line and then returns a table of the changes for each of those events:</p>

<p><img src="https://s3.us-east-2.amazonaws.com/thomgreene-blog-photos/vmware/vmconfigchanges/05-powerclioutput.png" alt="PowerCLI Output" /></p>

<p>Notice in row two it returns <strong>{VMware.Vim.VirtualDeviceConfigSpec}</strong>. This change was me adding 10 GB to the hard drive. I&rsquo;m not sure how to pull that information more specifically, however I now know to look for that command in the logs if I really need to know exactly how much they added. It&rsquo;s fantastic to pull memory and cpus. if the lines showed up blank I would remove the filters and look at all the configuration items to see if the user changed something a little more obscure.</p>

		</div>
		
<div class="post__tags tags clearfix">
	<svg class="icon icon-tag" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="m4.73135 3.3795002q0-.5597-.39604-.9557-.39604-.3961-.95577-.3961-.55974 0-.95578.3961-.39604.396-.39604.9557 0 .5598.39604.9558.39604.3961.95578.3961.55973 0 .95577-.3961.39604-.396.39604-.9558zm11.26865 6.0832q0 .5596998-.39076.9504998l-5.18548 5.196q-.41188.3908-.9610504.3908-.55974 0-.9505-.3908l-7.5511496-7.5616998q-.40132-.3907-.68119-1.0666-.27987-.6759-.27987-1.2357v-4.3934q0-.54920004.40132-.95050004.40132-.4013.9505-.4013h4.39339q.55974 0 1.23565.2799.67591.2798 1.07723.6812l7.55115 7.54060004q.39076.4118.39076.961z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link" href="/tags/esxcli/" rel="tag">ESXCLI</a></li>
		<li class="tags__item"><a class="tags__link" href="/tags/powercli/" rel="tag">PowerCLI</a></li>
	</ul>
</div>

	</article>
	
<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Thom Greene avatar" src="/img/avatar.png" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Thom Greene</span>
	</div>
	<div class="authorbox__description">
		vBrownbag crew, vExpert, Disney Nerd.
	</div>
</div>
	
<nav class="post-nav row clearfix" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement">
	<div class="post-nav__item post-nav__item--prev col-1-2">
		<a class="post-nav__link" href="/post/2016-03-11-switchmisconfig/" rel="prev"><span class="post-nav__caption">«Previous</span><p class="post-nav__post-title">Detecting a Misconfigured vSwitch</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next col-1-2">
		<a class="post-nav__link" href="/post/2016-03-18-vcap5dcaexperience/" rel="next"><span class="post-nav__caption">Next»</span><p class="post-nav__post-title">My VCAP5-DCA Experience</p></a>
	</div>
</nav>

	
</main>

<aside class="sidebar" itemscope="itemscope" itemtype="http://schema.org/WPSideBar">
	
<div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="//google.com/search">
		<label>
			<span class="screen-reader-text">Search for:</span>
			<input class="widget-search__field" type="search" placeholder="SEARCH..." value="" name="q">
		</label>
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="https://www.thomgreene.com/" />
	</form>
</div>
	
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/post/2018-04-04-vropslicensing/">VMware vRealize Operations Manager: Licensing and License Groups</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/2018-03-27-vropsdesignintro/">VMware vRealize Operations Manager: Design Introduction</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/2018-03-27-vropsdesignlab/">VMware vRealize Operations Manager: Design for a Home Lab</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/2017-08-30-hackingpublicspeaking/">Hacking Public Speaking - Mentors to Help you Rock It</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/2017-08-16-vmworld2017preview/">VMworld 2017 is Almost Here</a></li>
		</ul>
	</div>
</div>

	
<div class="widget-categories widget">
	<h4 class="widget__title">Categories</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/categories/certification">Certification</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/cloud">Cloud</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/community">Community</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/monitoring">Monitoring</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/presentations">Presentations</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/productivity">Productivity</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/tech-field-day">Tech-Field-Day</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/troubleshooting">Troubleshooting</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/vmware">Vmware</a></li>
		</ul>
	</div>
</div>
	
<div class="widget-social widget">
	<h4 class="widget-social__title widget__title">Social</h4>
	<div class="widget-social__content widget__content">
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Twitter" rel="noopener noreferrer" href="https://twitter.com/tbgree00" target="_blank">
				<svg class="widget-social__link-icon icon-twitter" viewBox="0 0 384 312" width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill="#fff"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5 0-78.8 35.3-78.8 78.8 0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3-6.7 11.6-10.6 25.2-10.6 39.6 0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1 0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4 0-12.6-.4-18.8-1.1 34.9 22.4 76.3 35.4 120.8 35.4 144.9 0 224.1-120 224.1-224.1 0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg>
				<span>Twitter</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="LinkedIn" rel="noopener noreferrer" href="https://linkedin.com/in/thom-greene" target="_blank">
				<svg class="widget-social__link-icon icon-linkedin" viewBox="0 0 352 352" width="24" height="24" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M0,40v272c0,21.9,18.1,40,40,40h272c21.9,0,40-18.1,40-40V40c0-21.9-18.1-40-40-40H40C18.1,0,0,18.1,0,40z M312,32 c4.6,0,8,3.4,8,8v272c0,4.6-3.4,8-8,8H40c-4.6,0-8-3.4-8-8V40c0-4.6,3.4-8,8-8H312z M59.5,87c0,15.2,12.3,27.5,27.5,27.5 c15.2,0,27.5-12.3,27.5-27.5c0-15.2-12.3-27.5-27.5-27.5C71.8,59.5,59.5,71.8,59.5,87z M187,157h-1v-21h-45v152h47v-75 c0-19.8,3.9-39,28.5-39c24.2,0,24.5,22.4,24.5,40v74h47v-83.5c0-40.9-8.7-72-56.5-72C208.5,132.5,193.3,145.1,187,157z M64,288h47.5 V136H64V288z"/></svg>
				<span>LinkedIn</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="GitHub" rel="noopener noreferrer" href="https://github.com/tbgree00" target="_blank">
				<svg class="widget-social__link-icon icon-github" viewBox="0 0 384 374" width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill="#fff"><path d="m192 0c-106.1 0-192 85.8-192 191.7 0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2 0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8 0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7 0 0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4 0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5 0 25.6-.2 46.3-.2 52.6 0 5.1 3.5 11.1 13.2 9.2 76.2-25.5 131.2-97.3 131.2-182 0-105.9-86-191.7-192-191.7z"/></svg>
				<span>GitHub</span>
			</a>
		</div>
	</div>
</div>

	
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget__link widget__link--taglist" href="/tags/aws" title="aws">aws</a>
		<a class="widget__link widget__link--taglist" href="/tags/azure" title="azure">azure</a>
		<a class="widget__link widget__link--taglist" href="/tags/command-line" title="command-line">command-line</a>
		<a class="widget__link widget__link--taglist" href="/tags/documentation" title="documentation">documentation</a>
		<a class="widget__link widget__link--taglist" href="/tags/esxcli" title="esxcli">esxcli</a>
		<a class="widget__link widget__link--taglist" href="/tags/hardware" title="hardware">hardware</a>
		<a class="widget__link widget__link--taglist" href="/tags/homelab" title="homelab">homelab</a>
		<a class="widget__link widget__link--taglist" href="/tags/mentoring" title="mentoring">mentoring</a>
		<a class="widget__link widget__link--taglist" href="/tags/networking" title="networking">networking</a>
		<a class="widget__link widget__link--taglist" href="/tags/openstack" title="openstack">openstack</a>
		<a class="widget__link widget__link--taglist" href="/tags/powercli" title="powercli">powercli</a>
		<a class="widget__link widget__link--taglist" href="/tags/public-speaking" title="public-speaking">public-speaking</a>
		<a class="widget__link widget__link--taglist" href="/tags/storage" title="storage">storage</a>
		<a class="widget__link widget__link--taglist" href="/tags/studying" title="studying">studying</a>
		<a class="widget__link widget__link--taglist" href="/tags/tfd13" title="tfd13">tfd13</a>
		<a class="widget__link widget__link--taglist" href="/tags/trip-report" title="trip-report">trip-report</a>
		<a class="widget__link widget__link--taglist" href="/tags/vcap" title="vcap">vcap</a>
		<a class="widget__link widget__link--taglist" href="/tags/vcdx" title="vcdx">vcdx</a>
		<a class="widget__link widget__link--taglist" href="/tags/vdm30in30" title="vdm30in30">vdm30in30</a>
		<a class="widget__link widget__link--taglist" href="/tags/vmworld" title="vmworld">vmworld</a>
		<a class="widget__link widget__link--taglist" href="/tags/vrealize-operations-manager" title="vrealize-operations-manager">vrealize-operations-manager</a>
	</div>
</div>
</aside>

	</div>
		<footer class="footer" itemscope="itemscope" itemtype="http://schema.org/WPFooter">
			<div class="container container-inner">
				<p class="footer__copyright">&copy; 2018 Virtualizing a Physical World. <span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad theme</a>.</span></p>
			</div>
		</footer>
	</div>

<script>
	var navigation = responsiveNav(".menu", {
		navClass: "menu--collapse",
	});
</script>
</body>
</html>
